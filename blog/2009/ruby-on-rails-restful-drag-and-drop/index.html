<!DOCTYPE html> <html lang="en"> <head> <meta name="google-site-verification" content="rnmSuvW5c0vt2XwF-WQLJ-5ezaSJzS34zY0HwUwDIks"/> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Ruby on Rails - RESTful Drag and Drop | Christopher Slade</title> <meta name="author" content="Christopher Slade"/> <meta name="description" content="Ruby on Rails and the script.acul.ous library make drag and drop really easy. Just by adding one line of code, and you can make anything in your page draggable. With another line of code, you can make anything receive a draggable element."/> <meta name="keywords" content="computer-science, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/favicon.ico"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://slades.dev/blog/2009/ruby-on-rails-restful-drag-and-drop/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Christopher </span>Slade</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/portfolio/">portfolfio</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Ruby on Rails - RESTful Drag and Drop</h1> <p class="post-meta">May 23, 2009• Christopher Slade</p> <p class="post-tags"> <a href="/blog/2009"> <i class="fas fa-calendar fa-sm"></i> 2009 </a>   ·   <a href="/blog/tag/drag%20and%20drop"> <i class="fas fa-hashtag fa-sm"></i> drag and drop</a>   <a href="/blog/tag/rails"> <i class="fas fa-hashtag fa-sm"></i> rails</a>   <a href="/blog/tag/ajax"> <i class="fas fa-hashtag fa-sm"></i> ajax</a>   <a href="/blog/tag/restful"> <i class="fas fa-hashtag fa-sm"></i> restful</a>   <a href="/blog/tag/technology"> <i class="fas fa-hashtag fa-sm"></i> technology</a>   </p> </header> <article class="post-content"> <p>Ruby on Rails and the script.acul.ous library makes drag and drop really easy. Just by adding one line of code, you can make anything on your page draggable. With another line of code, you can make anything receive a draggable element.</p> <p>However, I struggled in making my drag and drop interface <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer" target="_blank" rel="noopener noreferrer">RESTful</a>, and I also struggled in sending the new coordinates to the server to update the model. I will first address how I made my drag and drop RESTful and then how I managed to get the right coordinates of the drop.</p> <p>So here is the setup: I have a list of elements on the web page, and then a div tag into which the user can drag one of the listed elements. Then the user can drag the element around the div as well as drag the element off of the div to remove it. I want the server to remember what elements have been placed on the div and where they are. That way the user can re-visit the page and see it like he left it. These three actions easily fit into RESTful actions: Dragging an element on will call the create action, Moving an element will call the update action, and dragging an element off will call the destroy action.</p> <p>So the problem comes when droppable (or the receiving element) receives the draggable. You need to know the url of the RESTful action before anything has been dropped. This isn’t a problem for the create action, it is a POST to /draggable_elements (where draggable_element is the model that stores the elements that have been placed on the map with their X and Y coordinates). However update and delete’s url is a PUT or DELETE to /draggable_elements/id respectively. However you don’t know the id until the element has been dropped, and once an element is dropped, an AJAX request is immediately sent to the specified action with one parameter: the DOM id of the element that is dropped. You cannot specify the correct action because you don’t know the element’s id until after it is dropped, and you probably don’t want your DOM id’s to be just the numerical id of draggable_element. Also, the AJAX request doesn’t contain any information about where the drop occurred.</p> <p>I first tried to solve this problem with the :with option in the drop_receiving_element call. This allowed me to add additional parameters like the X and Y, but it didn’t allow me to change the action of the AJAX request. Here is my code in the view using the :with option:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;%= drop_receiving_element :droppable, :accept =&gt; "draggable", :hoverclass  =&gt; "hover", :url =&gt; draggable_elements_path, :method =&gt; :post, :with =&gt; "'element_id='+encodeURIComponent(element.id.split('_').last()) +
'&amp;x='+ encodeURIComponent(Element.getStyle(element,'left')) +  '&amp;y='+ encodeURIComponent(Element.getStyle(element,'top')) "&gt;
</code></pre></div></div> <p>I called split(‘_’).last() on the element.id to get the actual id number out of my DOM id of the element that was dragged in. I set the DOM ids of the draggable elements to item_id where the id is the database id of that element. split and encodeURIComponent are both javascript methods.</p> <p>I almost gave up on being RESTful, but then looked into the onDrop option. With this option, I can get the drop_receiving_element to call a javascript function instead of sending an AJAX request when it receives a draggable. I then created hidden forms on my page, one for creating, and an update and delete form for each element already dragged in. This worked out great because I could use the remote_form_for helper methods and just pass them instances of the draggable_elements (with a blank one for the create form). Now, each form will have the correct action coded into it. The javascript method just has to tell the right form to submit after updating the values.</p> <p>(If you want the form to send an AJAX request you need to call form.onsubmit() not form.submit(). form.submit() will send an http request.)</p> <p>The big payoff to all of this is that it really simplifies the controller code. In fact, I think the only change from the scaffolding code that you would need to make is to delete the new and edit actions since you won’t be using them. (I didn’t use the scaffolding so I am not sure about this.)</p> <p>I also wanted to send the new X and Y coordinates of the drop. In the code above, I am sending the element left and top for X and Y. The problem with that is that the positions are relative to where the draggable element is on the page. Therefore if the user scrolls the page down, zooms in, etc. the coordinate positions will change. After searching for a solution, I found out that in order to find the absolute position, you have to recurse through all the parent’s object and find the offset of each parent item and add them up. Put it all together, and you have a RESTful drag and drop that stores the absolute coordinates of the draggable elements.</p> <p>Here is my code:</p> <p>For enabling the draggable elements:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;% @items.each do |item| -%&gt;
      &lt;%= draggable_element "item_#{item.id}", :revert =&gt; true, :ghosting =&gt; true%&gt;
&lt;% end -%&gt;
</code></pre></div></div> <p>My droppable:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= drop_receiving_element :dropDiv, :accept =&gt; "draggable", :hoverclass =&gt; "hover", :onDrop  =&gt; "itemDropped"%&gt;
</code></pre></div></div> <p>And my javascript:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function itemDropped (draggableElement, droppableElement, event){
  form = document.getElementById("new_item");
  form.elements["draggable_element[element_id]"].value = draggableElement.id.split('_').last();
  dropDiv = document.getElementById("dropDiv");
  dropPosition = getPosition(dropDiv);
  draggablePosition = getPosition(draggableElement);
  form.elements["draggable_element[x]"].value = draggablePosition[0] - cmapPosition[0];
  form.elements["draggable_element[y]"].value = draggablePosition[1] - cmapPosition[1];
  form.onsubmit();
}

function getPosition (obj){
  var curLeft = 0;
  var curTop = 0;
  do {
    curLeft += obj.offsetLeft;
    curTop += obj.offsetTop;
  } while (obj = obj.offsetParent);
  return [curLeft,curTop]
}
</code></pre></div></div> <p>Notice that the get position adds up all of the parent’s offsets. This isn’t my complete code, it only sends the create form, but hopefully, it is enough to get you started.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Christopher Slade. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Last updated: September 24, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script type="text/javascript">$(function(){$('[data-toggle="tooltip"]').tooltip()});</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-12CJD7SYKF"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-12CJD7SYKF");</script> </body> </html>